<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POCKET Money</title>
    
    <!-- ★★★ ここから追加 ★★★ -->
    <meta name="theme-color" content="#f7f7f7"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <!-- ★★★ ここまで追加 ★★★ -->
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- (以降のコードはこれまでと同じです) -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* (styleタグの中身はこれまでと同じなので省略します) */
        :root{--bg-color:#f7f7f7;--container-bg:#ffffff;--text-color:#333333;--subtext-color:#888888;--border-color:#eeeeee;--accent-color:#333333;--income-color-text:#2a9d8f;--expense-color-text:#e76f51;--delete-color:#e74c3c}body{font-family:'Noto Sans',sans-serif;font-weight:400;margin:0;background-color:var(--bg-color);color:var(--text-color)}.container{max-width:600px;margin:0 auto;padding:20px 25px 150px}h1{text-align:center;font-weight:300;font-size:1.2em;letter-spacing:4px;margin:20px 0 30px}.summary-container{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;margin-bottom:25px}.summary-box{padding:10px 5px;text-align:center}.summary-box h2{margin:0 0 5px;font-size:11px;font-weight:400;color:var(--subtext-color);text-transform:uppercase}.summary-box p{margin:0;font-size:16px;font-weight:500}.chart-container{position:relative;margin:40px auto;max-width:300px;height:auto}#no-data-message{text-align:center;color:var(--subtext-color);padding:40px 0;display:none}.history-group-title{font-weight:500;font-size:.9em;color:var(--subtext-color);padding:15px 5px 10px;margin:20px 0 0;border-bottom:1px solid var(--border-color)}#history-container ul{list-style:none;padding:0}#history-container li{display:flex;align-items:center;padding:18px 5px;border-bottom:1px solid var(--border-color)}.item-icon{font-size:20px;margin-right:18px;flex-shrink:0}.item-details{flex-grow:1;flex-shrink:1;min-width:0;margin-right:10px}.item-category{font-weight:500;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-date-memo{font-size:12px;font-weight:300;color:var(--subtext-color)}.item-amount{font-weight:500;font-size:16px;white-space:nowrap;flex-shrink:0}.item-amount.income{color:var(--income-color-text)}.item-amount.expense{color:var(--expense-color-text)}.item-actions{display:flex;gap:10px;flex-shrink:0;margin-left:10px}.action-btn{background:none;border:none;cursor:pointer;font-size:20px;color:var(--subtext-color);padding:5px;opacity:.7}#add-transaction-btn{position:fixed;bottom:90px;right:25px;width:56px;height:56px;background-color:var(--accent-color);color:#fff;border:none;border-radius:50%;font-size:32px;font-weight:300;line-height:56px;text-align:center;cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,.15);transition:transform .2s;z-index:999}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);z-index:1000;opacity:0;pointer-events:none;transition:opacity .3s}.modal-overlay.active{opacity:1;pointer-events:all}.modal-content{position:fixed;bottom:0;left:0;right:0;background:var(--bg-color);padding:20px 25px 30px;border-radius:24px 24px 0 0;z-index:1001;transform:translateY(100%);transition:transform .3s cubic-bezier(.25,.8,.25,1)}.modal-overlay.active .modal-content{transform:translateY(0)}.form-toggle{display:flex;justify-content:center;gap:30px;margin-bottom:25px;position:relative}.toggle-btn{padding:10px 5px;background:none;border:none;cursor:pointer;font-size:16px;font-weight:400;color:var(--subtext-color)}.toggle-btn.active{font-weight:700;color:var(--text-color)}.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:15px 0}input[type=number],input[type=text]{width:100%;padding:14px;border:1px solid var(--border-color);background:var(--container-bg);border-radius:12px;font-size:15px;box-sizing:border-box}.custom-date-input{padding:14px;border:1px solid var(--border-color);background:var(--container-bg);border-radius:12px;font-size:15px;cursor:pointer;text-align:center}#category-buttons{grid-column:span 2;display:flex;flex-wrap:wrap;gap:10px}.category-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid var(--border-color);border-radius:12px;padding:8px;width:calc(25% - 8px);height:60px;font-size:10px;background:var(--container-bg);cursor:pointer}.category-btn.selected{border-color:var(--accent-color);border-width:1.5px;font-weight:500}.category-btn .icon{font-size:20px;margin-bottom:4px}.confirm-actions button,#submit-btn{grid-column:span 2;padding:16px;border:none;border-radius:12px;color:#fff;background:var(--accent-color);font-size:16px;font-weight:500;cursor:pointer}#toast{position:fixed;bottom:-100px;left:50%;transform:translateX(-50%);background:var(--accent-color);color:#fff;padding:12px 25px;border-radius:10px;transition:all .5s;z-index:1002}#toast.show{bottom:30px}#confirm-modal-content p{text-align:center;margin:10px 0 25px}.confirm-actions{display:grid;grid-template-columns:1fr 1fr;gap:15px}#confirm-delete-btn{background-color:var(--delete-color)}#cancel-delete-btn{background-color:var(--subtext-color)}
    </style>
</head>
<body>
    <!-- (bodyタグの中身はこれまでと同じなので省略します) -->
    <div class="container"><h1>BUDGET</h1><div class="summary-container"><div class="summary-box"><h2>Funds</h2><p id="total-funds">0 THB</p></div><div class="summary-box"><h2>Income</h2><p id="monthly-income">0 THB</p></div><div class="summary-box"><h2>Expense</h2><p id="monthly-expense">0 THB</p></div><div class="summary-box"><h2>Balance</h2><p id="monthly-balance">0 THB</p></div></div><div class="chart-container"><canvas id="expense-chart"></canvas><p id="no-data-message">No expense data for this month.</p></div><div id="history-container"></div></div><button id="add-transaction-btn">+</button><div id="modal-overlay" class="modal-overlay"><div id="modal-content" class="modal-content"><div class="form-toggle"><button id="toggle-expense" class="toggle-btn expense active">Expense</button><button id="toggle-income" class="toggle-btn income">Income</button></div><form id="transaction-form"><input type="hidden" id="transaction-id"><div class="form-grid"><div class="custom-date-input" id="custom-date-display"><span id="date-month">Mon</span> / <span id="date-day">Day</span> / <span id="date-year">Year</span></div><input type="date" id="date" style="display:none"><input type="number" id="amount" placeholder="Amount (THB)" inputmode="numeric" required><div id="category-buttons"></div><input type="text" id="memo" placeholder="Memo" style="grid-column:span 2"><button type="submit" id="submit-btn">Add Transaction</button></div></form></div></div><div id="confirm-modal-overlay" class="modal-overlay"><div id="confirm-modal-content" class="modal-content"><p>Are you sure you want to delete this record?</p><div class="confirm-actions"><button id="cancel-delete-btn">Cancel</button><button id="confirm-delete-btn">Delete</button></div></div></div><div id="toast"></div>

    <script>
        // ★★★ ここから追加 ★★★
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            });
        }
        // ★★★ ここまで追加 ★★★
    
        // (以降のscriptタグの中身はこれまでと同じなので省略します)
        const e=document.getElementById("expense-chart"),t=document.getElementById("no-data-message"),n=document.getElementById("transaction-id"),o=document.getElementById("add-transaction-btn"),i=document.getElementById("modal-overlay"),a=document.getElementById("toggle-expense"),c=document.getElementById("toggle-income"),s=document.getElementById("transaction-form"),d=document.getElementById("date"),l=document.getElementById("custom-date-display"),r=document.getElementById("amount"),m=document.getElementById("memo"),u=document.getElementById("category-buttons"),p=document.getElementById("history-container"),y=document.getElementById("total-funds"),h=document.getElementById("monthly-income"),f=document.getElementById("monthly-expense"),g=document.getElementById("monthly-balance"),v=document.getElementById("toast"),b=document.getElementById("submit-btn"),w=document.getElementById("confirm-modal-overlay"),E=document.getElementById("confirm-delete-btn"),k=document.getElementById("cancel-delete-btn"),L={expense:[{value:"Supermarket",icon:"🛒"},{value:"Cafe",icon:"☕️"},{value:"Clothing",icon:"👕"},{value:"Massage",icon:"💆‍♀️"},{value:"Nails",icon:"💅"},{value:"Waxing",icon:"✨"},{value:"Food",icon:"🍽️"},{value:"Transport",icon:"🚗"},{value:"Hobby/Fun",icon:"🎨"},{value:"Travel",icon:"✈️"},{value: "Social",icon:"🤝"},{value:"Daily Goods",icon:"🛍️"},{value:"Rent/Utilities",icon:"🏠"},{value:"Others",icon:"💡"}],income:[{value:"Salary",icon:"💰"},{value:"Extra Income",icon:"🪙"},{value:"Others",icon:"💡"}]};let x="expense",S="",C=JSON.parse(localStorage.getItem("transactions_final_fixed"))||[],M=null,T=!1,A=null;function N(){localStorage.setItem("transactions_final_fixed",JSON.stringify(C)),O()}function O(){P(),_()}function P(){historyContainer.innerHTML="";let e=0,t=0,n=0,o=0;const i=new Date,a=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;C.forEach((i=>{const s=i.date.startsWith(a);"income"===i.type?(e+=i.amount,s&&(n+=i.amount)):(t+=i.amount,s&&(o+=i.amount))}));const c=[...C].sort(((e,t)=>new Date(t.date)-new Date(e.date))),s=c.reduce(((e,t)=>{const n=t.date.substring(0,7);return e[n]||(e[n]=[]),e[n].push(t),e}),{}),d=["January","February","March","April","May","June","July","August","September","October","November","December"];if(0===Object.keys(s).length){const e=document.createElement("p");e.textContent="No transactions yet. Tap the '+' to add one!",e.style.textAlign="center",e.style.color="var(--subtext-color)",p.appendChild(e)}else for(const e in s){const[t,n]=e.split("-"),i=`${d[parseInt(n)-1]} ${t}`,c=document.createElement("h2");c.className="history-group-title",c.textContent=i,p.appendChild(c);const l=document.createElement("ul");l.style.padding="0",s[e].forEach((e=>{const t=L[e.type].find((t=>t.value===e.category))||{icon:"❓"},n=new Date(e.date+"T00:00:00"),i=`${d[n.getMonth()]} ${n.getDate()}, ${n.getFullYear()}`,c="income"===e.type?"income":"expense",s=document.createElement("li");s.dataset.id=e.id,s.innerHTML=`\n                        <div class="item-icon">${t.icon}</div>\n                        <div class="item-details">\n                            <div class="item-category">${e.category}</div>\n                            <div class="item-date-memo">${i} ${e.memo?`(${e.memo})`:""}</div>\n                        </div>\n                        <div class="item-amount ${c}">${"income"===e.type?"+":"-"}${e.amount.toLocaleString()} THB</div>\n                        <div class="item-actions">\n                            <button class="action-btn edit-btn">✏️</button>\n                            <button class="action-btn delete-btn">🗑️</button>\n                        </div>`,l.appendChild(s)})),p.appendChild(l)}y.textContent=`${(e-t).toLocaleString()} THB`,h.textContent=`${n.toLocaleString()} THB`,f.textContent=`${o.toLocaleString()} THB`,g.textContent=`${(n-o).toLocaleString()} THB`}function _(){const n=new Date,o=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`,i=C.filter((e=>"expense"===e.type&&e.date.startsWith(o)));if(0===i.length)return e.style.display="none",t.style.display="block",void(M&&M.destroy());e.style.display="block",t.style.display="none";const a=i.reduce(((e,t)=>(e[t.category]||(e[t.category]=0),e[t.category]+=t.amount,e)),{}),c=Object.keys(a),s=Object.values(a),d=["#a7c4b5","#d4a5a5","#88a0a8","#e5b9a8","#c3b1e1","#f0d9a7","#a8d0db","#e8a87c","#c8d6af","#b2b2b2"];M&&M.destroy();const l=e.getContext("2d");M=new Chart(l,{type:"doughnut",data:{labels:c,datasets:[{label:"Expense",data:s,backgroundColor:d,borderWidth:0,hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"bottom",labels:{boxWidth:12,font:{size:12}}},tooltip:{callbacks:{label:e=>`${e.label||""}: ${e.parsed.toLocaleString()} THB`}}}}})}function q(){if(d.value){const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date(d.value+"T00:00:00");document.getElementById("date-month").textContent=e[t.getMonth()],document.getElementById("date-day").textContent=t.getDate(),document.getElementById("date-year").textContent=t.getFullYear()}}function D(e=null){T||(T=!0,s.reset(),n.value="",e?(n.value=e.id,d.value=e.date,r.value=e.amount,m.value=e.memo,B(e.type,!0),H(e.category),b.textContent="Update Transaction",a.disabled=!0,c.disabled=!0):(B("expense"),d.valueAsDate=new Date,b.textContent="Add Transaction",a.disabled=!1,c.disabled=!1),q(),i.classList.add("active"))}function F(){i.classList.remove("active"),T=!1}function B(e,t=!1){x=e;const n="expense"===e;a.classList.toggle("active",n),c.classList.toggle("active",!n),t||I()}function I(){u.innerHTML="",S="";const e=L[x];e.forEach((e=>{const t=document.createElement("button");t.type="button",t.className="category-btn",t.dataset.value=e.value,t.innerHTML=`<span class="icon">${e.icon}</span><span>${e.value}</span>`,t.addEventListener("click",(()=>H(e.value))),u.appendChild(t)}))}function H(e){document.querySelectorAll(".category-btn").forEach((e=>e.classList.remove("selected")));const t=document.querySelector(`.category-btn[data-value="${e}"]`);t&&t.classList.add("selected"),S=e}function j(e){const t=e.target.closest(".action-btn");if(!t)return;const n=t.closest("li"),o=parseInt(n.dataset.id);if(t.classList.contains("edit-btn")){const e=C.find((e=>e.id===o));e&&(I(),D(e))}else t.classList.contains("delete-btn")&&G(o)}function z(e){v.textContent=e,v.classList.add("show"),setTimeout((()=>{v.classList.remove("show")}),2e3)}function G(e){A=e,w.classList.add("active")}function K(){A=null,w.classList.remove("active")}function V(){null!==A&&(C=C.filter((e=>e.id!==A)),N(),z("Deleted successfully"),K())}o.addEventListener("click",(()=>D())),i.addEventListener("click",(e=>{e.target===i&&F()})),l.addEventListener("click",(()=>d.showPicker())),d.addEventListener("change",q),a.addEventListener("click",(()=>B("expense"))),c.addEventListener("click",(()=>B("income"))),s.addEventListener("submit",(function(e){e.preventDefault(),S?function(e){const t=parseInt(r.value);if(isNaN(t)||t<0)return void alert("Please enter a valid, non-negative amount.");const o=n.value;o?(C.findIndex((e=>e.id==o)),C.find((e=>e.id==o))&&(C[C.findIndex((e=>e.id==o))]={id:parseInt(o),type:C.find((e=>e.id==o)).type,date:d.value,amount:t,category:S,memo:m.value}),z("Updated successfully"))):(C.push({id:Date.now(),type:x,date:d.value,amount:t,category:S,memo:m.value}),z("Record added"));N(),F()}(e):alert("Please select a category.")})),p.addEventListener("click",j),w.addEventListener("click",(e=>{e.target===w&&K()})),k.addEventListener("click",K),E.addEventListener("click",V),O();
    </script>
</body>
</html>